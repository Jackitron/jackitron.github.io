<!DOCTYPE html>
<!-- Jack Edwards 20039542 -->
<html lang="en">
    <head>
        <title>NASQL Editor</title>
        <!-- Scale the viewport to take the screen size of mobile devices into account. -->
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link rel="stylesheet" type="text/css" href="index.css"/>
        <link rel="icon" href="images/icon.png"/>
        
        <!-- External library for creating the split screen. -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>
    </head>
    
    <body>
    <!-- Left half of screen for graphical designer -->
    <div id="design" class="split split-horizontal" style="margin:0">
            <!-- React Flow Node Editor -->
            <div id="editor" class="nodegraph split">
                <div id="root"></div>
                <script type="module" src="/src/main.jsx"></script>
            </div>
            
            <!-- hidden inputs to save/load node graph -->
            <a hidden id="graphSaver" download="graph.json"></a>
            <input hidden id="graphLoader" type="file"></input>
            
            <!-- SQL Preview Text Box -->
            <div id="preview" class="codearea split">
                <div class="code-menubar">
                    <p style="display:flex; margin:3px; margin-right: auto; width:50%; min-width:2em">
                        SQL Code Preview
                    </p>
                    <button class="helpbutton" onclick="HelpHidden(false)"> Show Help Screen </button>
                    <button class="helpbutton" onclick="SchemaHidden(false)"> Show Database Schema </button>
                </div>
                <p id="code" class="codebox">
                    SQL Code will appear here.
                </p>
            </div>
    </div>
    
    <!-- Right half of screen for test area. -->
    <div id="testarea" class="testarea split split-horizontal">
        <div class="testbox">
            <!-- Form data is modified depending on node graph. -->
            <h2 style="min-width: 100%; margin:0"> Query Test Area </h2>
        
            <!-- Form inputs for query -->
            <!-- Form tag not used here since it would reload page! -->
            Input <b>A:</b> <input id="inputA"></input> 
            Input <b>B:</b> <input id="inputB"></input> <br/>
            Input <b>C:</b> <input id="inputC"></input> <br/>
            Input <b>D:</b> <input id="inputD"></input> <br/>
            <b>&emsp;Limit:</b><input id="limit" type="number" min="1" max="500" value="250"></input>
            <button onclick="SetQuery()">Submit</button>
            
            <!-- Response from server. -->
            <iframe id="dbframe" class="iframe-table">
            </iframe>
        </div>
    </div>
    
    <!-- Help for the example database schema -->
    <div hidden id="help-schema" class='helpdialog' onclick="SchemaHidden(true)">
        <h2>Database Schema View. Click anywhere to close.</h2>
        <img src="images/schema.png" style="height: 100%; aspect-ratio: 1;"></img>
    </div>
    
    <!-- Help dialog for the app -->
    <div id="help-start" class='helpdialog' onclick="HelpHidden(true)">
    <div style="width: min(100%, 50em)">
        <h2>NASQL Help. Click anywhere to close.</h2>
        <ul style="padding: 1em">
            <li><b>About NASQL</b></li>
            <ul>
                <li>NASQL, or Node-Activated Structured Query Language, is a graphical editor that
                uses an interactive node graph to create SQL selection queries.</li>
                <li>This program is provided "as is" with absolutely no warranty.
				The developers will not be liable nor responsible for any damages
				as a result of using this program or the output of this program.</li>
                <li>NASQL can be used to generate code. As such, the code you generate is solely your own,
				and your responsibility. Avoid including anything offensive or illegal in your code or node graph.</li>
            </ul>
			<br>
            <li><b>Web App Structure</b></li>
            <ul>
                <li>The web app is split into three areas: the node editor, the code preview and test area.</li>
				<li>Use the gray panel splits to change the size of these areas.</li>
                <li>If you are viewing this page online, the test area will not be used to connect to the database.</li>
                <li>Every graph in NASQL uses six 'fixed' nodes.
                These are circular and cannot be deleted.</li>
                <img style="width: min(40em, 100%)" src="images/help_nodes.jpg"/>
                <li>Changing a node on the graph will change the code preview.</li>
                <li>Note that the JOIN, GROUP, HAVING and ORDER nodes must be enabled
                or their options changed to something other than 'None' to affect the output.</li>
            </ul>
			<br>
            <li><b>SQL Node Controls</b></li>
            <ul>
                <li>Clicking on a node selects the node and all its children.</li>
                <li>If there is already a selection, clicking will select a single node.</li>
                <li>Clicking on the background clears the selection.</li>
                <img style="width:20em" src="images/help_select.gif"/>
                <li>Double clicking or tapping on a node adds a child node.</li>
                <li>Right-clicking, or a tap and hold on a touchscreen, deletes a node.</li>
                <img style="width:20em" src="images/help_add.gif"/>
                <li>Dragging on the background pans the view, and scrolling or pinching zooms in or out.</li>
                <li>Nodes can only be deleted if they have no children.</li>
                <li>Selected nodes can be dragged, and a group of selected nodes
                will be dragged as one.</li>
                <img style="width:30em" src="images/help_move.gif"/>
                <li>The buttons to the top-right of the screen provide the following functions:</li>
				<img style="height:9em; float:left; margin-right:2em;" src="images/help_buttons.png"/>
                <ul>
                    <li>Zoom In</li>
                    <li>Zoom Out</li>
                    <li>Center view onto nodes</li>
                    <li>"Lock" the nodes, stopping drag functionality.</li>
                    <li>"SAVE" the node layout to a file.</li>
                    <li>"LOAD" the node layout from a file.</li>
                </ul>
				<li>Dragging on the minimap lets you pan the view quickly.</li>
				<img style="width:10em" src="images/help_map.gif"/>
            </ul>
			<br>
            <li><b>Node Types</b></li>
            <ul>
                <li>SELECT : Provides the option to choose the data from the database to be displayed.</li>
				<li>The FROM section is handled automatically, based on the tables used in SELECT/WHERE.</li>
                <li>JOIN : Allows the use of primary keys to form links between multiple tables.</li>
                <li>WHERE : Provides a filter for data returned by specifying conditions.</li>
                <li>GROUP : Equivalent to GROUP BY, this provides attributes to group the data returned.</li>
                <li>HAVING : Allows the filtering of groups of data using an aggregate.</li>
                <li>ORDER : Equivalent to ORDER BY, this provides the columns to set the order of the results</li>
                <li>VALUE : Create constant data or reference tables or form inputs</li>
                <li>BOOLEAN : Child of WHERE nodes. Provides a choice of outcome for two or more logic nodes.</li>
                <li>LOGIC : Child of BOOLEAN nodes. Allows for the comparison of numbers, attributes and text strings. </li>
                <li>JOIN ON : Child of the JOIN node. Specifies the condition and join type of two tables.</li>
            </ul>
            </li>
        </ul>
    </div>
    
    <script type="text/javascript">
        // Attach the splitter 
        Split(['#design', '#testarea'], {
            direction: 'horizontal',
            cursor: 'ew-resize',
            sizes: [75, 25],
            minSize: 0,
            gutterSize: 11
        });
        Split(['#editor', '#preview'], {
            direction: 'vertical',
            cursor: 'ns-resize',
            sizes: [85, 15],
            minSize: 0,
            gutterSize: 11
        });
        
        // Show help/start screens again
        function HelpHidden(h) { document.getElementById('help-start').hidden = h; }
        function SchemaHidden(h) { document.getElementById('help-schema').hidden = h; }
        
        // Set the limit for the query response
        function SetLimit() {
            document.getElementById('limitLabel').innerHTML = event.target.value
        }
        
        // Set the query response to show in the iframe
        function SetQuery() {
            let code = document.getElementById('code').innerHTML;
            // Remove underlines + newlines used by editor
            code = code.replaceAll('<u>','').replaceAll('</u>','').replaceAll('<br>',' ');
            // Replace HTML-specific entity codes
            code = code.replaceAll('&gt;','>').replaceAll('&lt;','<').replaceAll('&amp;','&');
            // Same IP, different port.
            let URL = 'http://' + document.location.host + ':8080/'+code;
            document.getElementById('dbframe').setAttribute('src',URL);
            return code;
        }
    </script>
    </body>
</html>
